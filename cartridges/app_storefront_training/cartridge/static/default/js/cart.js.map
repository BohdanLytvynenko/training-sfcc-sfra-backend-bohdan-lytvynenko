{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./cartridges/app_storefront_training/cartridge/client/default/js/cart.js","webpack:///./cartridges/app_storefront_training/cartridge/client/default/js/cart/cart.js","webpack:///./cartridges/app_storefront_training/cartridge/client/default/js/product/base.js","webpack:///./cartridges/app_storefront_training/cartridge/client/default/js/util.js"],"names":["processInclude","require","$","document","ready","base","appendToUrl","url","params","newUrl","indexOf","Object","keys","map","key","encodeURIComponent","join","validateBasket","data","valid","error","message","errorHtml","append","empty","resources","emptyCartMsg","numberOfItems","numItems","removeClass","addClass","updateCartTotals","totals","totalShippingCost","totalTax","grandTotal","subTotal","orderLevelDiscountTotal","value","formatted","shippingLevelDiscountTotal","items","forEach","item","UUID","renderedPromotions","priceTotal","renderedPrice","createErrorNotification","updateApproachingDiscounts","approachingDiscounts","html","length","discountMsg","updateAvailability","uuid","lineItem","messages","i","availability","inStockDate","updateProductDetails","cartModel","find","variationAttributes","colorAttr","attr","attributeId","colorSelector","newColor","displayValue","text","sizeAttr","sizeSelector","newSize","imageSelector","images","small","alt","title","qtySelector","val","quantity","newProductId","priceSelector","price","sales","decimalPrice","list","listPriceSelector","getModalHtmlElement","remove","htmlString","parseHtml","$html","parseHTML","body","footer","children","fillModalElement","editProductUrl","spinner","start","ajax","method","dataType","success","parsedHtml","modal","stop","confirmDelete","actionUrl","productID","productName","$deleteConfirmBtn","$productToRemoveSpan","module","exports","on","e","preventDefault","click","toggle","urlParams","pid","type","basket","toBeDeletedUUIDs","hasBonusProduct","discountsHtml","trigger","err","responseJSON","redirectUrl","window","location","href","errorMessage","preSelectQty","parents","context","hasClass","reload","parseInt","change","methodID","submit","hide","show","$form","serialize","couponCode","code","methods","editBonusProducts","response","dialog","$productContainer","closest","product","readyToOrder","available","allAvailable","toArray","every","allReady","info_selectforstock","container","id","selectedQuantity","updateProductUrl","form","getPidValue","uuidToBeDeleted","selectAttribute","colorAttribute","removeBonusProduct","selectBonusProduct","enableBonusProductSelection","showMoreBonusProducts","addBonusProductsToCart","$el","getQuantitySelector","getQuantitySelected","processSwatchValues","values","attrValue","$attrValue","$swatchAnchor","parent","selected","removeAttr","selectable","processNonSwatchValues","$attr","$defaultOption","resetUrl","updateAttrs","attrs","attrsWithSwatches","availabilityValue","availabilityMessages","getPromotionsHtml","promotions","promotion","details","calloutMsg","getAttributesHtml","attributes","attributeGroup","ID","attribute","label","updateOptions","options","option","$optionEl","valueEl","handleVariantResponse","isChoiceOfBonusProducts","isVaraint","productType","primaryImageUrls","large","imageUrl","idx","eq","$priceSelector","replaceWith","$selectButton","updateQuantities","quantities","optionsHtml","attributeSelect","selectedValueUrl","getAddToCartUrl","chooseBonusProducts","bonusUrl","bonusChoiceRuleBased","showProductsUrlRuleBased","showProductsUrlListBased","maxBonusItems","pliUUID","addToCartUrl","pageSize","labels","selectprods","handlePostCartAdd","messageType","newBonusDiscountLineItem","setTimeout","getChildProducts","childProducts","each","push","JSON","stringify","getOptions","$elOption","urlValue","selectedValueId","optionId","currentTarget","addToCart","pidsObj","setPids","qty","$choiceOfBonusProduct","maxPids","submittedQty","totalQty","optionID","valueId","selectedBonusProductHtml","$selected","count","$readyToOrderBonusProducts","queryString","pidsObject","bonusProducts","qtyOption","productId","msgSuccess","include"],"mappings":"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","file":"default\\js\\cart.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./cartridges/app_storefront_training/cartridge/client/default/js/cart.js\");\n","'use strict';\r\n\r\nvar processInclude = require('./util');\r\n\r\n$(document).ready(function () {\r\n    processInclude(require('./cart/cart'));\r\n});\r\n","'use strict';\r\n\r\nvar base = require('../product/base');\r\n\r\n/**\r\n * appends params to a url\r\n * @param {string} url - Original url\r\n * @param {Object} params - Parameters to append\r\n * @returns {string} result url with appended parameters\r\n */\r\nfunction appendToUrl(url, params) {\r\n    var newUrl = url;\r\n    newUrl += (newUrl.indexOf('?') !== -1 ? '&' : '?') + Object.keys(params).map(function (key) {\r\n        return key + '=' + encodeURIComponent(params[key]);\r\n    }).join('&');\r\n\r\n    return newUrl;\r\n}\r\n\r\n/**\r\n * Checks whether the basket is valid. if invalid displays error message and disables\r\n * checkout button\r\n * @param {Object} data - AJAX response from the server\r\n */\r\nfunction validateBasket(data) {\r\n    if (data.valid.error) {\r\n        if (data.valid.message) {\r\n            var errorHtml = '<div class=\"alert alert-danger alert-dismissible valid-cart-error ' +\r\n                'fade show\" role=\"alert\">' +\r\n                '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">' +\r\n                '<span aria-hidden=\"true\">&times;</span>' +\r\n                '</button>' + data.valid.message + '</div>';\r\n\r\n            $('.cart-error').append(errorHtml);\r\n        } else {\r\n            $('.cart').empty().append('<div class=\"row\"> ' +\r\n                '<div class=\"col-12 text-center\"> ' +\r\n                '<h1>' + data.resources.emptyCartMsg + '</h1> ' +\r\n                '</div> ' +\r\n                '</div>'\r\n            );\r\n            $('.number-of-items').empty().append(data.resources.numberOfItems);\r\n            $('.minicart-quantity').empty().append(data.numItems);\r\n            $('.minicart .popover').empty();\r\n            $('.minicart .popover').removeClass('show');\r\n        }\r\n\r\n        $('.checkout-btn').addClass('disabled');\r\n    } else {\r\n        $('.checkout-btn').removeClass('disabled');\r\n    }\r\n}\r\n\r\n/**\r\n * re-renders the order totals and the number of items in the cart\r\n * @param {Object} data - AJAX response from the server\r\n */\r\nfunction updateCartTotals(data) {\r\n    $('.number-of-items').empty().append(data.resources.numberOfItems);\r\n    $('.shipping-cost').empty().append(data.totals.totalShippingCost);\r\n    $('.tax-total').empty().append(data.totals.totalTax);\r\n    $('.grand-total').empty().append(data.totals.grandTotal);\r\n    $('.sub-total').empty().append(data.totals.subTotal);\r\n    $('.minicart-quantity').empty().append(data.numItems);\r\n\r\n    if (data.totals.orderLevelDiscountTotal.value > 0) {\r\n        $('.order-discount').removeClass('hide-order-discount');\r\n        $('.order-discount-total').empty()\r\n            .append('- ' + data.totals.orderLevelDiscountTotal.formatted);\r\n    } else {\r\n        $('.order-discount').addClass('hide-order-discount');\r\n    }\r\n\r\n    if (data.totals.shippingLevelDiscountTotal.value > 0) {\r\n        $('.shipping-discount').removeClass('hide-shipping-discount');\r\n        $('.shipping-discount-total').empty().append('- ' +\r\n            data.totals.shippingLevelDiscountTotal.formatted);\r\n    } else {\r\n        $('.shipping-discount').addClass('hide-shipping-discount');\r\n    }\r\n\r\n    data.items.forEach(function (item) {\r\n        $('.item-' + item.UUID).empty().append(item.renderedPromotions);\r\n        $('.item-total-' + item.UUID).empty().append(item.priceTotal.renderedPrice);\r\n    });\r\n}\r\n\r\n/**\r\n * re-renders the order totals and the number of items in the cart\r\n * @param {Object} message - Error message to display\r\n */\r\nfunction createErrorNotification(message) {\r\n    var errorHtml = '<div class=\"alert alert-danger alert-dismissible valid-cart-error ' +\r\n        'fade show\" role=\"alert\">' +\r\n        '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">' +\r\n        '<span aria-hidden=\"true\">&times;</span>' +\r\n        '</button>' + message + '</div>';\r\n\r\n    $('.cart-error').append(errorHtml);\r\n}\r\n\r\n/**\r\n * re-renders the approaching discount messages\r\n * @param {Object} approachingDiscounts - updated approaching discounts for the cart\r\n */\r\nfunction updateApproachingDiscounts(approachingDiscounts) {\r\n    var html = '';\r\n    $('.approaching-discounts').empty();\r\n    if (approachingDiscounts.length > 0) {\r\n        approachingDiscounts.forEach(function (item) {\r\n            html += '<div class=\"single-approaching-discount text-center\">'\r\n                + item.discountMsg + '</div>';\r\n        });\r\n    }\r\n    $('.approaching-discounts').append(html);\r\n}\r\n\r\n/**\r\n * Updates the availability of a product line item\r\n * @param {Object} data - AJAX response from the server\r\n * @param {string} uuid - The uuid of the product line item to update\r\n */\r\nfunction updateAvailability(data, uuid) {\r\n    var lineItem;\r\n    var messages = '';\r\n\r\n    for (var i = 0; i < data.items.length; i++) {\r\n        if (data.items[i].UUID === uuid) {\r\n            lineItem = data.items[i];\r\n            break;\r\n        }\r\n    }\r\n\r\n    $('.availability-' + lineItem.UUID).empty();\r\n\r\n    if (lineItem.availability) {\r\n        if (lineItem.availability.messages) {\r\n            lineItem.availability.messages.forEach(function (message) {\r\n                messages += '<p class=\"line-item-attributes\">' + message + '</p>';\r\n            });\r\n        }\r\n\r\n        if (lineItem.availability.inStockDate) {\r\n            messages += '<p class=\"line-item-attributes line-item-instock-date\">'\r\n                + lineItem.availability.inStockDate\r\n                + '</p>';\r\n        }\r\n    }\r\n\r\n    $('.availability-' + lineItem.UUID).html(messages);\r\n}\r\n\r\n/**\r\n * Updates details of a product line item\r\n * @param {Object} data - AJAX response from the server\r\n * @param {string} uuid - The uuid of the product line item to update\r\n */\r\nfunction updateProductDetails(data, uuid) {\r\n    var lineItem = data.cartModel.items.find(function (item) {\r\n        return item.UUID === uuid;\r\n    });\r\n\r\n    if (lineItem.variationAttributes) {\r\n        var colorAttr = lineItem.variationAttributes.find(function (attr) {\r\n            return attr.attributeId === 'color';\r\n        });\r\n\r\n        if (colorAttr) {\r\n            var colorSelector = '.Color-' + uuid;\r\n            var newColor = 'Color: ' + colorAttr.displayValue;\r\n            $(colorSelector).text(newColor);\r\n        }\r\n\r\n        var sizeAttr = lineItem.variationAttributes.find(function (attr) {\r\n            return attr.attributeId === 'size';\r\n        });\r\n\r\n        if (sizeAttr) {\r\n            var sizeSelector = '.Size-' + uuid;\r\n            var newSize = 'Size: ' + sizeAttr.displayValue;\r\n            $(sizeSelector).text(newSize);\r\n        }\r\n\r\n        var imageSelector = '.card.product-info.uuid-' + uuid + ' .item-image > img';\r\n        $(imageSelector).attr('src', lineItem.images.small[0].url);\r\n        $(imageSelector).attr('alt', lineItem.images.small[0].alt);\r\n        $(imageSelector).attr('title', lineItem.images.small[0].title);\r\n    }\r\n\r\n    var qtySelector = '.quantity[data-uuid=\"' + uuid + '\"]';\r\n    $(qtySelector).val(lineItem.quantity);\r\n    $(qtySelector).data('pid', data.newProductId);\r\n\r\n    $('.remove-product[data-uuid=\"' + uuid + '\"]').data('pid', data.newProductId);\r\n\r\n    var priceSelector = '.line-item-price-' + uuid + ' .sales .value';\r\n    $(priceSelector).text(lineItem.price.sales.formatted);\r\n    $(priceSelector).attr('content', lineItem.price.sales.decimalPrice);\r\n\r\n    if (lineItem.price.list) {\r\n        var listPriceSelector = '.line-item-price-' + uuid + ' .list .value';\r\n        $(listPriceSelector).text(lineItem.price.list.formatted);\r\n        $(listPriceSelector).attr('content', lineItem.price.list.decimalPrice);\r\n    }\r\n}\r\n\r\n/**\r\n * Generates the modal window on the first call.\r\n *\r\n */\r\nfunction getModalHtmlElement() {\r\n    if ($('#editProductModal').length !== 0) {\r\n        $('#editProductModal').remove();\r\n    }\r\n    var htmlString = '<!-- Modal -->'\r\n        + '<div class=\"modal fade\" id=\"editProductModal\" role=\"dialog\">'\r\n        + '<div class=\"modal-dialog quick-view-dialog\">'\r\n        + '<!-- Modal content-->'\r\n        + '<div class=\"modal-content\">'\r\n        + '<div class=\"modal-header\">'\r\n        + '    <button type=\"button\" class=\"close pull-right\" data-dismiss=\"modal\">'\r\n        + '        &times;'\r\n        + '    </button>'\r\n        + '</div>'\r\n        + '<div class=\"modal-body\"></div>'\r\n        + '<div class=\"modal-footer\"></div>'\r\n        + '</div>'\r\n        + '</div>'\r\n        + '</div>';\r\n    $('body').append(htmlString);\r\n}\r\n\r\n/**\r\n * Parses the html for a modal window\r\n * @param {string} html - representing the body and footer of the modal window\r\n *\r\n * @return {Object} - Object with properties body and footer.\r\n */\r\nfunction parseHtml(html) {\r\n    var $html = $('<div>').append($.parseHTML(html));\r\n\r\n    var body = $html.find('.product-quickview');\r\n    var footer = $html.find('.modal-footer').children();\r\n\r\n    return { body: body, footer: footer };\r\n}\r\n\r\n/**\r\n * replaces the content in the modal window for product variation to be edited.\r\n * @param {string} editProductUrl - url to be used to retrieve a new product model\r\n */\r\nfunction fillModalElement(editProductUrl) {\r\n    $('.modal-body').spinner().start();\r\n    $.ajax({\r\n        url: editProductUrl,\r\n        method: 'GET',\r\n        dataType: 'html',\r\n        success: function (html) {\r\n            var parsedHtml = parseHtml(html);\r\n\r\n            $('#editProductModal .modal-body').empty();\r\n            $('#editProductModal .modal-body').html(parsedHtml.body);\r\n            $('#editProductModal .modal-footer').html(parsedHtml.footer);\r\n            $('#editProductModal').modal('show');\r\n            $.spinner().stop();\r\n        },\r\n        error: function () {\r\n            $.spinner().stop();\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * replace content of modal\r\n * @param {string} actionUrl - url to be used to remove product\r\n * @param {string} productID - pid\r\n * @param {string} productName - product name\r\n * @param {string} uuid - uuid\r\n */\r\nfunction confirmDelete(actionUrl, productID, productName, uuid) {\r\n    var $deleteConfirmBtn = $('.cart-delete-confirmation-btn');\r\n    var $productToRemoveSpan = $('.product-to-remove');\r\n\r\n    $deleteConfirmBtn.data('pid', productID);\r\n    $deleteConfirmBtn.data('action', actionUrl);\r\n    $deleteConfirmBtn.data('uuid', uuid);\r\n\r\n    $productToRemoveSpan.empty().append(productName);\r\n}\r\n\r\nmodule.exports = function () {\r\n    $('body').on('click', '.remove-product', function (e) {\r\n        e.preventDefault();\r\n\r\n        var actionUrl = $(this).data('action');\r\n        var productID = $(this).data('pid');\r\n        var productName = $(this).data('name');\r\n        var uuid = $(this).data('uuid');\r\n        confirmDelete(actionUrl, productID, productName, uuid);\r\n    });\r\n\r\n    $('body').on('afterRemoveFromCart', function (e, data) {\r\n        e.preventDefault();\r\n        confirmDelete(data.actionUrl, data.productID, data.productName, data.uuid);\r\n    });\r\n\r\n    $('.optional-promo').click(function (e) {\r\n        e.preventDefault();\r\n        $('.promo-code-form').toggle();\r\n    });\r\n\r\n    $('body').on('click', '.cart-delete-confirmation-btn', function (e) {\r\n        e.preventDefault();\r\n\r\n        var productID = $(this).data('pid');\r\n        var url = $(this).data('action');\r\n        var uuid = $(this).data('uuid');\r\n        var urlParams = {\r\n            pid: productID,\r\n            uuid: uuid\r\n        };\r\n\r\n        url = appendToUrl(url, urlParams);\r\n\r\n        $('body > .modal-backdrop').remove();\r\n\r\n        $.spinner().start();\r\n        $.ajax({\r\n            url: url,\r\n            type: 'get',\r\n            dataType: 'json',\r\n            success: function (data) {\r\n                if (data.basket.items.length === 0) {\r\n                    $('.cart').empty().append('<div class=\"row\"> ' +\r\n                        '<div class=\"col-12 text-center\"> ' +\r\n                        '<h1>' + data.basket.resources.emptyCartMsg + '</h1> ' +\r\n                        '</div> ' +\r\n                        '</div>'\r\n                    );\r\n                    $('.number-of-items').empty().append(data.basket.resources.numberOfItems);\r\n                    $('.minicart-quantity').empty().append(data.basket.numItems);\r\n                    $('.minicart .popover').empty();\r\n                    $('.minicart .popover').removeClass('show');\r\n                    $('body').removeClass('modal-open');\r\n                    $('html').removeClass('veiled');\r\n                } else {\r\n                    if (data.toBeDeletedUUIDs && data.toBeDeletedUUIDs.length > 0) {\r\n                        for (var i = 0; i < data.toBeDeletedUUIDs.length; i++) {\r\n                            $('.uuid-' + data.toBeDeletedUUIDs[i]).remove();\r\n                        }\r\n                    }\r\n                    $('.uuid-' + uuid).remove();\r\n                    if (!data.basket.hasBonusProduct) {\r\n                        $('.bonus-product').remove();\r\n                    }\r\n                    $('.coupons-and-promos').empty().append(data.basket.totals.discountsHtml);\r\n                    updateCartTotals(data.basket);\r\n                    updateApproachingDiscounts(data.basket.approachingDiscounts);\r\n                    $('body').trigger('setShippingMethodSelection', data.basket);\r\n                    validateBasket(data.basket);\r\n                }\r\n                $.spinner().stop();\r\n            },\r\n            error: function (err) {\r\n                if (err.responseJSON.redirectUrl) {\r\n                    window.location.href = err.responseJSON.redirectUrl;\r\n                } else {\r\n                    createErrorNotification(err.responseJSON.errorMessage);\r\n                    $.spinner().stop();\r\n                }\r\n            }\r\n        });\r\n    });\r\n\r\n    $('body').on('change', '.quantity-form > .quantity', function () {\r\n        var preSelectQty = $(this).data('pre-select-qty');\r\n        var quantity = $(this).val();\r\n        var productID = $(this).data('pid');\r\n        var url = $(this).data('action');\r\n        var uuid = $(this).data('uuid');\r\n\r\n        var urlParams = {\r\n            pid: productID,\r\n            quantity: quantity,\r\n            uuid: uuid\r\n        };\r\n        url = appendToUrl(url, urlParams);\r\n\r\n        $(this).parents('.card').spinner().start();\r\n\r\n        $.ajax({\r\n            url: url,\r\n            type: 'get',\r\n            context: this,\r\n            dataType: 'json',\r\n            success: function (data) {\r\n                $('.quantity[data-uuid=\"' + uuid + '\"]').val(quantity);\r\n                $('.coupons-and-promos').empty().append(data.totals.discountsHtml);\r\n                updateCartTotals(data);\r\n                updateApproachingDiscounts(data.approachingDiscounts);\r\n                updateAvailability(data, uuid);\r\n                validateBasket(data);\r\n                $(this).data('pre-select-qty', quantity);\r\n                $.spinner().stop();\r\n                if ($(this).parents('.product-info').hasClass('bonus-product-line-item') && $('.cart-page').length) {\r\n                    location.reload();\r\n                }\r\n            },\r\n            error: function (err) {\r\n                if (err.responseJSON.redirectUrl) {\r\n                    window.location.href = err.responseJSON.redirectUrl;\r\n                } else {\r\n                    createErrorNotification(err.responseJSON.errorMessage);\r\n                    $(this).val(parseInt(preSelectQty, 10));\r\n                    $.spinner().stop();\r\n                }\r\n            }\r\n        });\r\n    });\r\n\r\n    $('.shippingMethods').change(function () {\r\n        var url = $(this).attr('data-actionUrl');\r\n        var urlParams = {\r\n            methodID: $(this).find(':selected').attr('data-shipping-id')\r\n        };\r\n        // url = appendToUrl(url, urlParams);\r\n\r\n        $('.totals').spinner().start();\r\n        $.ajax({\r\n            url: url,\r\n            type: 'post',\r\n            dataType: 'json',\r\n            data: urlParams,\r\n            success: function (data) {\r\n                if (data.error) {\r\n                    window.location.href = data.redirectUrl;\r\n                } else {\r\n                    $('.coupons-and-promos').empty().append(data.totals.discountsHtml);\r\n                    updateCartTotals(data);\r\n                    updateApproachingDiscounts(data.approachingDiscounts);\r\n                    validateBasket(data);\r\n                }\r\n                $.spinner().stop();\r\n            },\r\n            error: function (err) {\r\n                if (err.redirectUrl) {\r\n                    window.location.href = err.redirectUrl;\r\n                } else {\r\n                    createErrorNotification(err.responseJSON.errorMessage);\r\n                    $.spinner().stop();\r\n                }\r\n            }\r\n        });\r\n    });\r\n\r\n    $('.promo-code-form').submit(function (e) {\r\n        e.preventDefault();\r\n        $.spinner().start();\r\n        $('.coupon-missing-error').hide();\r\n        $('.coupon-error-message').empty();\r\n        if (!$('.coupon-code-field').val()) {\r\n            $('.promo-code-form .form-control').addClass('is-invalid');\r\n            $('.coupon-missing-error').show();\r\n            $.spinner().stop();\r\n            return false;\r\n        }\r\n        var $form = $('.promo-code-form');\r\n        $('.promo-code-form .form-control').removeClass('is-invalid');\r\n        $('.coupon-error-message').empty();\r\n\r\n        $.ajax({\r\n            url: $form.attr('action'),\r\n            type: 'GET',\r\n            dataType: 'json',\r\n            data: $form.serialize(),\r\n            success: function (data) {\r\n                if (data.error) {\r\n                    $('.promo-code-form .form-control').addClass('is-invalid');\r\n                    $('.coupon-error-message').empty().append(data.errorMessage);\r\n                } else {\r\n                    $('.coupons-and-promos').empty().append(data.totals.discountsHtml);\r\n                    updateCartTotals(data);\r\n                    updateApproachingDiscounts(data.approachingDiscounts);\r\n                    validateBasket(data);\r\n                }\r\n                $('.coupon-code-field').val('');\r\n                $.spinner().stop();\r\n            },\r\n            error: function (err) {\r\n                if (err.responseJSON.redirectUrl) {\r\n                    window.location.href = err.responseJSON.redirectUrl;\r\n                } else {\r\n                    createErrorNotification(err.errorMessage);\r\n                    $.spinner().stop();\r\n                }\r\n            }\r\n        });\r\n        return false;\r\n    });\r\n\r\n    $('body').on('click', '.remove-coupon', function (e) {\r\n        e.preventDefault();\r\n\r\n        var couponCode = $(this).data('code');\r\n        var uuid = $(this).data('uuid');\r\n        var $deleteConfirmBtn = $('.delete-coupon-confirmation-btn');\r\n        var $productToRemoveSpan = $('.coupon-to-remove');\r\n\r\n        $deleteConfirmBtn.data('uuid', uuid);\r\n        $deleteConfirmBtn.data('code', couponCode);\r\n\r\n        $productToRemoveSpan.empty().append(couponCode);\r\n    });\r\n\r\n    $('body').on('click', '.delete-coupon-confirmation-btn', function (e) {\r\n        e.preventDefault();\r\n\r\n        var url = $(this).data('action');\r\n        var uuid = $(this).data('uuid');\r\n        var couponCode = $(this).data('code');\r\n        var urlParams = {\r\n            code: couponCode,\r\n            uuid: uuid\r\n        };\r\n\r\n        url = appendToUrl(url, urlParams);\r\n\r\n        $('body > .modal-backdrop').remove();\r\n\r\n        $.spinner().start();\r\n        $.ajax({\r\n            url: url,\r\n            type: 'get',\r\n            dataType: 'json',\r\n            success: function (data) {\r\n                $('.coupon-uuid-' + uuid).remove();\r\n                updateCartTotals(data);\r\n                updateApproachingDiscounts(data.approachingDiscounts);\r\n                validateBasket(data);\r\n                $.spinner().stop();\r\n            },\r\n            error: function (err) {\r\n                if (err.responseJSON.redirectUrl) {\r\n                    window.location.href = err.responseJSON.redirectUrl;\r\n                } else {\r\n                    createErrorNotification(err.responseJSON.errorMessage);\r\n                    $.spinner().stop();\r\n                }\r\n            }\r\n        });\r\n    });\r\n    $('body').on('click', '.cart-page .bonus-product-button', function () {\r\n        $.spinner().start();\r\n        $.ajax({\r\n            url: $(this).data('url'),\r\n            method: 'GET',\r\n            dataType: 'json',\r\n            success: function (data) {\r\n                base.methods.editBonusProducts(data);\r\n                $.spinner().stop();\r\n            },\r\n            error: function () {\r\n                $.spinner().stop();\r\n            }\r\n        });\r\n    });\r\n    $('body').on('click', '.cart-page .product-edit .edit, .cart-page .bundle-edit .edit', function (e) {\r\n        e.preventDefault();\r\n\r\n        var editProductUrl = $(this).attr('href');\r\n        getModalHtmlElement();\r\n        fillModalElement(editProductUrl);\r\n    });\r\n\r\n    $('body').on('product:updateAddToCart', function (e, response) {\r\n        // update global add to cart (single products, bundles)\r\n        var dialog = $(response.$productContainer)\r\n            .closest('.quick-view-dialog');\r\n\r\n        $('.update-cart-product-global', dialog).attr('disabled',\r\n            !$('.global-availability', dialog).data('ready-to-order')\r\n            || !$('.global-availability', dialog).data('available')\r\n        );\r\n    });\r\n\r\n    $('body').on('product:updateAvailability', function (e, response) {\r\n        // bundle individual products\r\n        $('.product-availability', response.$productContainer)\r\n            .data('ready-to-order', response.product.readyToOrder)\r\n            .data('available', response.product.available)\r\n            .find('.availability-msg')\r\n            .empty()\r\n            .html(response.message);\r\n\r\n\r\n        var dialog = $(response.$productContainer)\r\n            .closest('.quick-view-dialog');\r\n\r\n        if ($('.product-availability', dialog).length) {\r\n            // bundle all products\r\n            var allAvailable = $('.product-availability', dialog).toArray()\r\n                .every(function (item) { return $(item).data('available'); });\r\n\r\n            var allReady = $('.product-availability', dialog).toArray()\r\n                .every(function (item) { return $(item).data('ready-to-order'); });\r\n\r\n            $('.global-availability', dialog)\r\n                .data('ready-to-order', allReady)\r\n                .data('available', allAvailable);\r\n\r\n            $('.global-availability .availability-msg', dialog).empty()\r\n                .html(allReady ? response.message : response.resources.info_selectforstock);\r\n        } else {\r\n            // single product\r\n            $('.global-availability', dialog)\r\n                .data('ready-to-order', response.product.readyToOrder)\r\n                .data('available', response.product.available)\r\n                .find('.availability-msg')\r\n                .empty()\r\n                .html(response.message);\r\n        }\r\n    });\r\n\r\n    $('body').on('product:afterAttributeSelect', function (e, response) {\r\n        if ($('.modal.show .product-quickview .bundle-items').length) {\r\n            $('.modal.show').find(response.container).data('pid', response.data.product.id);\r\n            $('.modal.show').find(response.container).find('.product-id').text(response.data.product.id);\r\n        } else {\r\n            $('.modal.show .product-quickview').data('pid', response.data.product.id);\r\n        }\r\n    });\r\n\r\n    $('body').on('change', '.quantity-select', function () {\r\n        var selectedQuantity = $(this).val();\r\n        $('.modal.show .update-cart-url').data('selected-quantity', selectedQuantity);\r\n    });\r\n\r\n    $('body').on('click', '.update-cart-product-global', function (e) {\r\n        e.preventDefault();\r\n\r\n        var updateProductUrl = $(this).closest('.cart-and-ipay').find('.update-cart-url').val();\r\n        var selectedQuantity = $(this).closest('.cart-and-ipay').find('.update-cart-url').data('selected-quantity');\r\n        var uuid = $(this).closest('.cart-and-ipay').find('.update-cart-url').data('uuid');\r\n\r\n        var form = {\r\n            uuid: uuid,\r\n            pid: base.getPidValue($(this)),\r\n            quantity: selectedQuantity\r\n        };\r\n\r\n        $(this).parents('.card').spinner().start();\r\n        if (updateProductUrl) {\r\n            $.ajax({\r\n                url: updateProductUrl,\r\n                type: 'post',\r\n                context: this,\r\n                data: form,\r\n                dataType: 'json',\r\n                success: function (data) {\r\n                    $('#editProductModal').remove();\r\n                    $('.modal-backdrop').remove();\r\n                    $('body').removeClass('modal-open');\r\n\r\n                    $('.coupons-and-promos').empty().append(data.cartModel.totals.discountsHtml);\r\n                    updateCartTotals(data.cartModel);\r\n                    updateApproachingDiscounts(data.cartModel.approachingDiscounts);\r\n                    updateAvailability(data.cartModel, uuid);\r\n                    updateProductDetails(data, uuid);\r\n\r\n                    if (data.uuidToBeDeleted) {\r\n                        $('.uuid-' + data.uuidToBeDeleted).remove();\r\n                    }\r\n\r\n                    validateBasket(data.cartModel);\r\n\r\n                    $.spinner().stop();\r\n                },\r\n                error: function (err) {\r\n                    if (err.responseJSON.redirectUrl) {\r\n                        window.location.href = err.responseJSON.redirectUrl;\r\n                    } else {\r\n                        createErrorNotification(err.responseJSON.errorMessage);\r\n                        $.spinner().stop();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n\r\n    base.selectAttribute();\r\n    base.colorAttribute();\r\n    base.removeBonusProduct();\r\n    base.selectBonusProduct();\r\n    base.enableBonusProductSelection();\r\n    base.showMoreBonusProducts();\r\n    base.addBonusProductsToCart();\r\n};\r\n","'use strict';\r\n\r\n/**\r\n * Retrieves the relevant pid value\r\n * @param {jquery} $el - DOM container for a given add to cart button\r\n * @return {string} - value to be used when adding product to cart\r\n */\r\nfunction getPidValue($el) {\r\n    var pid;\r\n\r\n    if ($('#quickViewModal').hasClass('show') && !$('.product-set').length) {\r\n        pid = $($el).closest('.modal-content').find('.product-quickview').data('pid');\r\n    } else if ($('.product-set-detail').length || $('.product-set').length) {\r\n        pid = $($el).closest('.product-detail').find('.product-id').text();\r\n    } else {\r\n        pid = $('.product-detail:not(\".bundle-item\")').data('pid');\r\n    }\r\n\r\n    return pid;\r\n}\r\n\r\n/**\r\n * Retrieve contextual quantity selector\r\n * @param {jquery} $el - DOM container for the relevant quantity\r\n * @return {jquery} - quantity selector DOM container\r\n */\r\nfunction getQuantitySelector($el) {\r\n    return $el && $('.set-items').length\r\n        ? $($el).closest('.product-detail').find('.quantity-select')\r\n        : $('.quantity-select');\r\n}\r\n\r\n/**\r\n * Retrieves the value associated with the Quantity pull-down menu\r\n * @param {jquery} $el - DOM container for the relevant quantity\r\n * @return {string} - value found in the quantity input\r\n */\r\nfunction getQuantitySelected($el) {\r\n    return getQuantitySelector($el).val();\r\n}\r\n\r\n/**\r\n * Process the attribute values for an attribute that has image swatches\r\n *\r\n * @param {Object} attr - Attribute\r\n * @param {string} attr.id - Attribute ID\r\n * @param {Object[]} attr.values - Array of attribute value objects\r\n * @param {string} attr.values.value - Attribute coded value\r\n * @param {string} attr.values.url - URL to de/select an attribute value of the product\r\n * @param {boolean} attr.values.isSelectable - Flag as to whether an attribute value can be\r\n *     selected.  If there is no variant that corresponds to a specific combination of attribute\r\n *     values, an attribute may be disabled in the Product Detail Page\r\n * @param {jQuery} $productContainer - DOM container for a given product\r\n */\r\nfunction processSwatchValues(attr, $productContainer) {\r\n    attr.values.forEach(function (attrValue) {\r\n        var $attrValue = $productContainer.find('[data-attr=\"' + attr.id + '\"] [data-attr-value=\"' +\r\n            attrValue.value + '\"]');\r\n        var $swatchAnchor = $attrValue.parent();\r\n\r\n        if (attrValue.selected) {\r\n            $attrValue.addClass('selected');\r\n        } else {\r\n            $attrValue.removeClass('selected');\r\n        }\r\n\r\n        if (attrValue.url) {\r\n            $swatchAnchor.attr('href', attrValue.url);\r\n        } else {\r\n            $swatchAnchor.removeAttr('href');\r\n        }\r\n\r\n        // Disable if not selectable\r\n        $attrValue.removeClass('selectable unselectable');\r\n\r\n        $attrValue.addClass(attrValue.selectable ? 'selectable' : 'unselectable');\r\n    });\r\n}\r\n\r\n/**\r\n * Process attribute values associated with an attribute that does not have image swatches\r\n *\r\n * @param {Object} attr - Attribute\r\n * @param {string} attr.id - Attribute ID\r\n * @param {Object[]} attr.values - Array of attribute value objects\r\n * @param {string} attr.values.value - Attribute coded value\r\n * @param {string} attr.values.url - URL to de/select an attribute value of the product\r\n * @param {boolean} attr.values.isSelectable - Flag as to whether an attribute value can be\r\n *     selected.  If there is no variant that corresponds to a specific combination of attribute\r\n *     values, an attribute may be disabled in the Product Detail Page\r\n * @param {jQuery} $productContainer - DOM container for a given product\r\n */\r\nfunction processNonSwatchValues(attr, $productContainer) {\r\n    var $attr = '[data-attr=\"' + attr.id + '\"]';\r\n    var $defaultOption = $productContainer.find($attr + ' .select-' + attr.id + ' option:first');\r\n    $defaultOption.attr('value', attr.resetUrl);\r\n\r\n    attr.values.forEach(function (attrValue) {\r\n        var $attrValue = $productContainer\r\n            .find($attr + ' [data-attr-value=\"' + attrValue.value + '\"]');\r\n        $attrValue.attr('value', attrValue.url)\r\n            .removeAttr('disabled');\r\n\r\n        if (!attrValue.selectable) {\r\n            $attrValue.attr('disabled', true);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Routes the handling of attribute processing depending on whether the attribute has image\r\n *     swatches or not\r\n *\r\n * @param {Object} attrs - Attribute\r\n * @param {string} attr.id - Attribute ID\r\n * @param {jQuery} $productContainer - DOM element for a given product\r\n */\r\nfunction updateAttrs(attrs, $productContainer) {\r\n    // Currently, the only attribute type that has image swatches is Color.\r\n    var attrsWithSwatches = ['color'];\r\n\r\n    attrs.forEach(function (attr) {\r\n        if (attrsWithSwatches.indexOf(attr.id) > -1) {\r\n            processSwatchValues(attr, $productContainer);\r\n        } else {\r\n            processNonSwatchValues(attr, $productContainer);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Updates the availability status in the Product Detail Page\r\n *\r\n * @param {Object} response - Ajax response object after an\r\n *                            attribute value has been [de]selected\r\n * @param {jQuery} $productContainer - DOM element for a given product\r\n */\r\nfunction updateAvailability(response, $productContainer) {\r\n    var availabilityValue = '';\r\n    var availabilityMessages = response.product.availability.messages;\r\n    if (!response.product.readyToOrder) {\r\n        availabilityValue = '<div>' + response.resources.info_selectforstock + '</div>';\r\n    } else {\r\n        availabilityMessages.forEach(function (message) {\r\n            availabilityValue += '<div>' + message + '</div>';\r\n        });\r\n    }\r\n\r\n    $($productContainer).trigger('product:updateAvailability', {\r\n        product: response.product,\r\n        $productContainer: $productContainer,\r\n        message: availabilityValue,\r\n        resources: response.resources\r\n    });\r\n}\r\n\r\n/**\r\n * Generates html for promotions section\r\n *\r\n * @param {array} promotions - list of promotions\r\n * @return {string} - Compiled HTML\r\n */\r\nfunction getPromotionsHtml(promotions) {\r\n    if (!promotions) {\r\n        return '';\r\n    }\r\n\r\n    var html = '';\r\n\r\n    promotions.forEach(function (promotion) {\r\n        html += '<div class=\"callout\" title=\"' + promotion.details + '\">' + promotion.calloutMsg +\r\n            '</div>';\r\n    });\r\n\r\n    return html;\r\n}\r\n\r\n/**\r\n * Generates html for product attributes section\r\n *\r\n * @param {array} attributes - list of attributes\r\n * @return {string} - Compiled HTML\r\n */\r\nfunction getAttributesHtml(attributes) {\r\n    if (!attributes) {\r\n        return '';\r\n    }\r\n\r\n    var html = '';\r\n\r\n    attributes.forEach(function (attributeGroup) {\r\n        if (attributeGroup.ID === 'mainAttributes') {\r\n            attributeGroup.attributes.forEach(function (attribute) {\r\n                html += '<div class=\"attribute-values\">' + attribute.label + ': '\r\n                    + attribute.value + '</div>';\r\n            });\r\n        }\r\n    });\r\n\r\n    return html;\r\n}\r\n\r\n/**\r\n * @typedef UpdatedOptionValue\r\n * @type Object\r\n * @property {string} id - Option value ID for look up\r\n * @property {string} url - Updated option value selection URL\r\n */\r\n\r\n/**\r\n * @typedef OptionSelectionResponse\r\n * @type Object\r\n * @property {string} priceHtml - Updated price HTML code\r\n * @property {Object} options - Updated Options\r\n * @property {string} options.id - Option ID\r\n * @property {UpdatedOptionValue[]} options.values - Option values\r\n */\r\n\r\n/**\r\n * Updates DOM using post-option selection Ajax response\r\n *\r\n * @param {OptionSelectionResponse} options - Ajax response options from selecting a product option\r\n * @param {jQuery} $productContainer - DOM element for current product\r\n */\r\nfunction updateOptions(options, $productContainer) {\r\n    options.forEach(function (option) {\r\n        var $optionEl = $productContainer.find('.product-option[data-option-id*=\"' + option.id\r\n            + '\"]');\r\n        option.values.forEach(function (value) {\r\n            var valueEl = $optionEl.find('option[data-value-id*=\"' + value.id + '\"]');\r\n            valueEl.val(value.url);\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Parses JSON from Ajax call made whenever an attribute value is [de]selected\r\n * @param {Object} response - response from Ajax call\r\n * @param {Object} response.product - Product object\r\n * @param {string} response.product.id - Product ID\r\n * @param {Object[]} response.product.variationAttributes - Product attributes\r\n * @param {Object[]} response.product.images - Product images\r\n * @param {boolean} response.product.hasRequiredAttrsSelected - Flag as to whether all required\r\n *     attributes have been selected.  Used partially to\r\n *     determine whether the Add to Cart button can be enabled\r\n * @param {jQuery} $productContainer - DOM element for a given product.\r\n */\r\nfunction handleVariantResponse(response, $productContainer) {\r\n    var isChoiceOfBonusProducts =\r\n        $productContainer.parents('.choose-bonus-product-dialog').length > 0;\r\n    var isVaraint;\r\n    if (response.product.variationAttributes) {\r\n        updateAttrs(response.product.variationAttributes, $productContainer);\r\n        isVaraint = response.product.productType === 'variant';\r\n        if (isChoiceOfBonusProducts && isVaraint) {\r\n            $productContainer.parent('.bonus-product-item')\r\n                .data('pid', response.product.id);\r\n\r\n            $productContainer.parent('.bonus-product-item')\r\n                .data('ready-to-order', response.product.readyToOrder);\r\n        }\r\n    }\r\n\r\n    // Update primary images\r\n    var primaryImageUrls = response.product.images;\r\n    primaryImageUrls.large.forEach(function (imageUrl, idx) {\r\n        $productContainer.find('.primary-images').find('img').eq(idx)\r\n            .attr('src', imageUrl.url);\r\n    });\r\n\r\n    // Update pricing\r\n    if (!isChoiceOfBonusProducts) {\r\n        var $priceSelector = $('.prices .price', $productContainer).length\r\n            ? $('.prices .price', $productContainer)\r\n            : $('.prices .price');\r\n        $priceSelector.replaceWith(response.product.price.html);\r\n    }\r\n\r\n    // Update promotions\r\n    $('.promotions').empty().html(getPromotionsHtml(response.product.promotions));\r\n\r\n    updateAvailability(response, $productContainer);\r\n\r\n    if (isChoiceOfBonusProducts) {\r\n        var $selectButton = $productContainer.find('.select-bonus-product');\r\n        $selectButton.trigger('bonusproduct:updateSelectButton', {\r\n            product: response.product, $productContainer: $productContainer\r\n        });\r\n    } else {\r\n        // Enable \"Add to Cart\" button if all required attributes have been selected\r\n        $('button.add-to-cart, button.add-to-cart-global, button.update-cart-product-global').trigger('product:updateAddToCart', {\r\n            product: response.product, $productContainer: $productContainer\r\n        }).trigger('product:statusUpdate', response.product);\r\n    }\r\n\r\n    // Update attributes\r\n    $productContainer.find('.main-attributes').empty()\r\n        .html(getAttributesHtml(response.product.attributes));\r\n}\r\n\r\n/**\r\n * @typespec UpdatedQuantity\r\n * @type Object\r\n * @property {boolean} selected - Whether the quantity has been selected\r\n * @property {string} value - The number of products to purchase\r\n * @property {string} url - Compiled URL that specifies variation attributes, product ID, options,\r\n *     etc.\r\n */\r\n\r\n/**\r\n * Updates the quantity DOM elements post Ajax call\r\n * @param {UpdatedQuantity[]} quantities -\r\n * @param {jQuery} $productContainer - DOM container for a given product\r\n */\r\nfunction updateQuantities(quantities, $productContainer) {\r\n    if (!($productContainer.parent('.bonus-product-item').length > 0)) {\r\n        var optionsHtml = quantities.map(function (quantity) {\r\n            var selected = quantity.selected ? ' selected ' : '';\r\n            return '<option value=\"' + quantity.value + '\"  data-url=\"' + quantity.url + '\"' +\r\n                selected + '>' + quantity.value + '</option>';\r\n        }).join('');\r\n        getQuantitySelector($productContainer).empty().html(optionsHtml);\r\n    }\r\n}\r\n\r\n/**\r\n * updates the product view when a product attribute is selected or deselected or when\r\n *         changing quantity\r\n * @param {string} selectedValueUrl - the Url for the selected variation value\r\n * @param {jQuery} $productContainer - DOM element for current product\r\n */\r\nfunction attributeSelect(selectedValueUrl, $productContainer) {\r\n    if (selectedValueUrl) {\r\n        $('body').trigger('product:beforeAttributeSelect',\r\n            { url: selectedValueUrl, container: $productContainer });\r\n\r\n        $.ajax({\r\n            url: selectedValueUrl,\r\n            method: 'GET',\r\n            success: function (data) {\r\n                handleVariantResponse(data, $productContainer);\r\n                updateOptions(data.product.options, $productContainer);\r\n                updateQuantities(data.product.quantities, $productContainer);\r\n                $('body').trigger('product:afterAttributeSelect',\r\n                    { data: data, container: $productContainer });\r\n                $.spinner().stop();\r\n            },\r\n            error: function () {\r\n                $.spinner().stop();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Retrieves url to use when adding a product to the cart\r\n *\r\n * @return {string} - The provided URL to use when adding a product to the cart\r\n */\r\nfunction getAddToCartUrl() {\r\n    return $('.add-to-cart-url').val();\r\n}\r\n\r\n/**\r\n * Parses the html for a modal window\r\n * @param {string} html - representing the body and footer of the modal window\r\n *\r\n * @return {Object} - Object with properties body and footer.\r\n */\r\nfunction parseHtml(html) {\r\n    var $html = $('<div>').append($.parseHTML(html));\r\n\r\n    var body = $html.find('.choice-of-bonus-product');\r\n    var footer = $html.find('.modal-footer').children();\r\n\r\n    return { body: body, footer: footer };\r\n}\r\n\r\n/**\r\n * Retrieves url to use when adding a product to the cart\r\n *\r\n * @param {Object} data - data object used to fill in dynamic portions of the html\r\n */\r\nfunction chooseBonusProducts(data) {\r\n    $('.modal-body').spinner().start();\r\n\r\n    if ($('#chooseBonusProductModal').length !== 0) {\r\n        $('#chooseBonusProductModal').remove();\r\n    }\r\n    var bonusUrl;\r\n    if (data.bonusChoiceRuleBased) {\r\n        bonusUrl = data.showProductsUrlRuleBased;\r\n    } else {\r\n        bonusUrl = data.showProductsUrlListBased;\r\n    }\r\n\r\n    var htmlString = '<!-- Modal -->'\r\n        + '<div class=\"modal fade\" id=\"chooseBonusProductModal\" role=\"dialog\">'\r\n        + '<div class=\"modal-dialog choose-bonus-product-dialog\" '\r\n        + 'data-total-qty=\"' + data.maxBonusItems + '\"'\r\n        + 'data-UUID=\"' + data.uuid + '\"'\r\n        + 'data-pliUUID=\"' + data.pliUUID + '\"'\r\n        + 'data-addToCartUrl=\"' + data.addToCartUrl + '\"'\r\n        + 'data-pageStart=\"0\"'\r\n        + 'data-pageSize=\"' + data.pageSize + '\"'\r\n        + 'data-moreURL=\"' + data.showProductsUrlRuleBased + '\"'\r\n        + 'data-bonusChoiceRuleBased=\"' + data.bonusChoiceRuleBased + '\">'\r\n        + '<!-- Modal content-->'\r\n        + '<div class=\"modal-content\">'\r\n        + '<div class=\"modal-header\">'\r\n        + '    <span class=\"\">' + data.labels.selectprods + '</span>'\r\n        + '    <button type=\"button\" class=\"close pull-right\" data-dismiss=\"modal\">&times;</button>'\r\n        + '</div>'\r\n        + '<div class=\"modal-body\"></div>'\r\n        + '<div class=\"modal-footer\"></div>'\r\n        + '</div>'\r\n        + '</div>'\r\n        + '</div>';\r\n    $('body').append(htmlString);\r\n    $('.modal-body').spinner().start();\r\n\r\n    $.ajax({\r\n        url: bonusUrl,\r\n        method: 'GET',\r\n        dataType: 'html',\r\n        success: function (html) {\r\n            var parsedHtml = parseHtml(html);\r\n            $('#chooseBonusProductModal .modal-body').empty();\r\n            $('#chooseBonusProductModal .modal-body').html(parsedHtml.body);\r\n            $('#chooseBonusProductModal .modal-footer').html(parsedHtml.footer);\r\n            $('#chooseBonusProductModal').modal('show');\r\n            $.spinner().stop();\r\n        },\r\n        error: function () {\r\n            $.spinner().stop();\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Updates the Mini-Cart quantity value after the customer has pressed the \"Add to Cart\" button\r\n * @param {string} response - ajax response from clicking the add to cart button\r\n */\r\nfunction handlePostCartAdd(response) {\r\n    $('.minicart').trigger('count:update', response);\r\n    var messageType = response.error ? 'alert-danger' : 'alert-success';\r\n    // show add to cart toast\r\n    if (response.newBonusDiscountLineItem\r\n        && Object.keys(response.newBonusDiscountLineItem).length !== 0) {\r\n        chooseBonusProducts(response.newBonusDiscountLineItem);\r\n    } else {\r\n        if ($('.add-to-cart-messages').length === 0) {\r\n            $('body').append(\r\n            '<div class=\"add-to-cart-messages\"></div>'\r\n            );\r\n        }\r\n\r\n        $('.add-to-cart-messages').append(\r\n            '<div class=\"alert ' + messageType + ' add-to-basket-alert text-center\" role=\"alert\">'\r\n            + response.message\r\n            + '</div>'\r\n        );\r\n\r\n        setTimeout(function () {\r\n            $('.add-to-basket-alert').remove();\r\n        }, 5000);\r\n    }\r\n}\r\n\r\n/**\r\n * Retrieves the bundle product item ID's for the Controller to replace bundle master product\r\n * items with their selected variants\r\n *\r\n * @return {string[]} - List of selected bundle product item ID's\r\n */\r\nfunction getChildProducts() {\r\n    var childProducts = [];\r\n    $('.bundle-item').each(function () {\r\n        childProducts.push({\r\n            pid: $(this).find('.product-id').text(),\r\n            quantity: parseInt($(this).find('label.quantity').data('quantity'), 10)\r\n        });\r\n    });\r\n\r\n    return childProducts.length ? JSON.stringify(childProducts) : [];\r\n}\r\n\r\n/**\r\n * Retrieve product options\r\n *\r\n * @param {jQuery} $productContainer - DOM element for current product\r\n * @return {string} - Product options and their selected values\r\n */\r\nfunction getOptions($productContainer) {\r\n    var options = $productContainer\r\n        .find('.product-option')\r\n        .map(function () {\r\n            var $elOption = $(this).find('.options-select');\r\n            var urlValue = $elOption.val();\r\n            var selectedValueId = $elOption.find('option[value=\"' + urlValue + '\"]')\r\n                .data('value-id');\r\n            return {\r\n                optionId: $(this).data('option-id'),\r\n                selectedValueId: selectedValueId\r\n            };\r\n        }).toArray();\r\n\r\n    return JSON.stringify(options);\r\n}\r\n\r\nmodule.exports = {\r\n    attributeSelect: attributeSelect,\r\n    methods: {\r\n        editBonusProducts: function (data) {\r\n            chooseBonusProducts(data);\r\n        }\r\n    },\r\n    colorAttribute: function () {\r\n        $(document).on('click', '[data-attr=\"color\"] a', function (e) {\r\n            e.preventDefault();\r\n\r\n            if ($(this).attr('disabled')) {\r\n                return;\r\n            }\r\n            var $productContainer = $(this).closest('.set-item');\r\n            if (!$productContainer.length) {\r\n                $productContainer = $(this).closest('.product-detail');\r\n            }\r\n\r\n            attributeSelect(e.currentTarget.href, $productContainer);\r\n        });\r\n    },\r\n\r\n    selectAttribute: function () {\r\n        $(document).on('change', 'select[class*=\"select-\"], .options-select', function (e) {\r\n            e.preventDefault();\r\n\r\n            var $productContainer = $(this).closest('.set-item');\r\n            if (!$productContainer.length) {\r\n                $productContainer = $(this).closest('.product-detail');\r\n            }\r\n            attributeSelect(e.currentTarget.value, $productContainer);\r\n        });\r\n    },\r\n\r\n    availability: function () {\r\n        $(document).on('change', '.quantity-select', function (e) {\r\n            e.preventDefault();\r\n\r\n            var $productContainer = $(this).closest('.product-detail');\r\n            if (!$productContainer.length) {\r\n                $productContainer = $(this).closest('.modal-content').find('.product-quickview');\r\n            }\r\n\r\n            if ($('.bundle-items', $productContainer).length === 0) {\r\n                attributeSelect($(e.currentTarget).find('option:selected').data('url'),\r\n                    $productContainer);\r\n            }\r\n        });\r\n    },\r\n\r\n    addToCart: function () {\r\n        $(document).on('click', 'button.add-to-cart, button.add-to-cart-global', function () {\r\n            var addToCartUrl;\r\n            var pid;\r\n            var pidsObj;\r\n            var setPids;\r\n\r\n            $('body').trigger('product:beforeAddToCart', this);\r\n\r\n            if ($('.set-items').length && $(this).hasClass('add-to-cart-global')) {\r\n                setPids = [];\r\n\r\n                $('.product-detail').each(function () {\r\n                    if (!$(this).hasClass('product-set-detail')) {\r\n                        setPids.push({\r\n                            pid: $(this).find('.product-id').text(),\r\n                            qty: $(this).find('.quantity-select').val(),\r\n                            options: getOptions($(this))\r\n                        });\r\n                    }\r\n                });\r\n                pidsObj = JSON.stringify(setPids);\r\n            }\r\n\r\n            pid = getPidValue($(this));\r\n\r\n            var $productContainer = $(this).closest('.product-detail');\r\n            if (!$productContainer.length) {\r\n                $productContainer = $(this).closest('.quick-view-dialog').find('.product-detail');\r\n            }\r\n\r\n            addToCartUrl = getAddToCartUrl();\r\n\r\n            var form = {\r\n                pid: pid,\r\n                pidsObj: pidsObj,\r\n                childProducts: getChildProducts(),\r\n                quantity: getQuantitySelected($(this))\r\n            };\r\n\r\n            if (!$('.bundle-item').length) {\r\n                form.options = getOptions($productContainer);\r\n            }\r\n\r\n            $(this).trigger('updateAddToCartFormData', form);\r\n            if (addToCartUrl) {\r\n                $.ajax({\r\n                    url: addToCartUrl,\r\n                    method: 'POST',\r\n                    data: form,\r\n                    success: function (data) {\r\n                        handlePostCartAdd(data);\r\n                        $('body').trigger('product:afterAddToCart', data);\r\n                        $.spinner().stop();\r\n                    },\r\n                    error: function () {\r\n                        $.spinner().stop();\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    },\r\n    selectBonusProduct: function () {\r\n        $(document).on('click', '.select-bonus-product', function () {\r\n            var $choiceOfBonusProduct = $(this).parents('.choice-of-bonus-product');\r\n            var pid = $(this).data('pid');\r\n            var maxPids = $('.choose-bonus-product-dialog').data('total-qty');\r\n            var submittedQty = parseInt($(this).parents('.choice-of-bonus-product').find('.bonus-quantity-select').val(), 10);\r\n            var totalQty = 0;\r\n            $.each($('#chooseBonusProductModal .selected-bonus-products .selected-pid'), function () {\r\n                totalQty += $(this).data('qty');\r\n            });\r\n            totalQty += submittedQty;\r\n            var optionID = $(this).parents('.choice-of-bonus-product').find('.product-option').data('option-id');\r\n            var valueId = $(this).parents('.choice-of-bonus-product').find('.options-select option:selected').data('valueId');\r\n            if (totalQty <= maxPids) {\r\n                var selectedBonusProductHtml = ''\r\n                + '<div class=\"selected-pid row\" '\r\n                + 'data-pid=\"' + pid + '\"'\r\n                + 'data-qty=\"' + submittedQty + '\"'\r\n                + 'data-optionID=\"' + (optionID || '') + '\"'\r\n                + 'data-option-selected-value=\"' + (valueId || '') + '\"'\r\n                + '>'\r\n                + '<div class=\"col-sm-11 col-9 bonus-product-name\" >'\r\n                + $choiceOfBonusProduct.find('.product-name').html()\r\n                + '</div>'\r\n                + '<div class=\"col-1\"><i class=\"fa fa-times\" aria-hidden=\"true\"></i></div>'\r\n                + '</div>'\r\n                ;\r\n                $('#chooseBonusProductModal .selected-bonus-products').append(selectedBonusProductHtml);\r\n                $('.pre-cart-products').html(totalQty);\r\n                $('.selected-bonus-products .bonus-summary').removeClass('alert-danger');\r\n            } else {\r\n                $('.selected-bonus-products .bonus-summary').addClass('alert-danger');\r\n            }\r\n        });\r\n    },\r\n    removeBonusProduct: function () {\r\n        $(document).on('click', '.selected-pid', function () {\r\n            $(this).remove();\r\n            var $selected = $('#chooseBonusProductModal .selected-bonus-products .selected-pid');\r\n            var count = 0;\r\n            if ($selected.length) {\r\n                $selected.each(function () {\r\n                    count += parseInt($(this).data('qty'), 10);\r\n                });\r\n            }\r\n\r\n            $('.pre-cart-products').html(count);\r\n            $('.selected-bonus-products .bonus-summary').removeClass('alert-danger');\r\n        });\r\n    },\r\n    enableBonusProductSelection: function () {\r\n        $('body').on('bonusproduct:updateSelectButton', function (e, response) {\r\n            $('button.select-bonus-product', response.$productContainer).attr('disabled',\r\n                (!response.product.readyToOrder || !response.product.available));\r\n            var pid = response.product.id;\r\n            $('button.select-bonus-product').data('pid', pid);\r\n        });\r\n    },\r\n    showMoreBonusProducts: function () {\r\n        $(document).on('click', '.show-more-bonus-products', function () {\r\n            var url = $(this).data('url');\r\n            $('.modal-content').spinner().start();\r\n            $.ajax({\r\n                url: url,\r\n                method: 'GET',\r\n                success: function (html) {\r\n                    var parsedHtml = parseHtml(html);\r\n                    $('.modal-body').append(parsedHtml.body);\r\n                    $('.show-more-bonus-products:first').remove();\r\n                    $('.modal-content').spinner().stop();\r\n                },\r\n                error: function () {\r\n                    $('.modal-content').spinner().stop();\r\n                }\r\n            });\r\n        });\r\n    },\r\n    addBonusProductsToCart: function () {\r\n        $(document).on('click', '.add-bonus-products', function () {\r\n            var $readyToOrderBonusProducts = $('.choose-bonus-product-dialog .selected-pid');\r\n            var queryString = '?pids=';\r\n            var url = $('.choose-bonus-product-dialog').data('addtocarturl');\r\n            var pidsObject = {\r\n                bonusProducts: []\r\n            };\r\n\r\n            $.each($readyToOrderBonusProducts, function () {\r\n                var qtyOption =\r\n                    parseInt($(this)\r\n                        .data('qty'), 10);\r\n\r\n                var option = null;\r\n                if (qtyOption > 0) {\r\n                    if ($(this).data('optionid') && $(this).data('option-selected-value')) {\r\n                        option = {};\r\n                        option.optionId = $(this).data('optionid');\r\n                        option.productId = $(this).data('pid');\r\n                        option.selectedValueId = $(this).data('option-selected-value');\r\n                    }\r\n                    pidsObject.bonusProducts.push({\r\n                        pid: $(this).data('pid'),\r\n                        qty: qtyOption,\r\n                        options: [option]\r\n                    });\r\n                    pidsObject.totalQty = parseInt($('.pre-cart-products').html(), 10);\r\n                }\r\n            });\r\n            queryString += JSON.stringify(pidsObject);\r\n            queryString = queryString + '&uuid=' + $('.choose-bonus-product-dialog').data('uuid');\r\n            queryString = queryString + '&pliuuid=' + $('.choose-bonus-product-dialog').data('pliuuid');\r\n            $.spinner().start();\r\n            $.ajax({\r\n                url: url + queryString,\r\n                method: 'POST',\r\n                success: function (data) {\r\n                    $.spinner().stop();\r\n                    if (data.error) {\r\n                        $('.error-choice-of-bonus-products')\r\n                        .html(data.errorMessage);\r\n                    } else {\r\n                        $('.configure-bonus-product-attributes').html(data);\r\n                        $('.bonus-products-step2').removeClass('hidden-xl-down');\r\n                        $('#chooseBonusProductModal').modal('hide');\r\n\r\n                        if ($('.add-to-cart-messages').length === 0) {\r\n                            $('body').append(\r\n                            '<div class=\"add-to-cart-messages\"></div>'\r\n                         );\r\n                        }\r\n                        $('.minicart-quantity').html(data.totalQty);\r\n                        $('.add-to-cart-messages').append(\r\n                            '<div class=\"alert alert-success add-to-basket-alert text-center\"'\r\n                            + ' role=\"alert\">'\r\n                            + data.msgSuccess + '</div>'\r\n                        );\r\n                        setTimeout(function () {\r\n                            $('.add-to-basket-alert').remove();\r\n                            if ($('.cart-page').length) {\r\n                                location.reload();\r\n                            }\r\n                        }, 3000);\r\n                    }\r\n                },\r\n                error: function () {\r\n                    $.spinner().stop();\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    getPidValue: getPidValue\r\n};\r\n","'use strict';\r\n\r\nmodule.exports = function (include) {\r\n    if (typeof include === 'function') {\r\n        include();\r\n    } else if (typeof include === 'object') {\r\n        Object.keys(include).forEach(function (key) {\r\n            if (typeof include[key] === 'function') {\r\n                include[key]();\r\n            }\r\n        });\r\n    }\r\n};\r\n"],"sourceRoot":""}